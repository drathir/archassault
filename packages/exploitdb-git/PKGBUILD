# Maintainer: ArchAssault <team@archassault.org>
pkgname=exploitdb-git
pkgver=r357.c0a405f
pkgrel=1
groups=('archassault' 'archassault-exploits')
pkgdesc="The official Exploit Database repository"
arch=('any')
url='https://github.com/offensive-security/exploit-database'
license=('GPL')
depends=('bash')
makedepends=('git')
options=('!strip')
replaces=('exploit-db')
conflicts=('exploit-db')
provides=('exploit-database' 'exploit-db' 'exploitdb')
source=("exploit-database::git+https://github.com/offensive-security/exploit-database.git")
sha512sums=('SKIP')

pkgver() {
  cd "$srcdir/exploit-database"
  printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

package() {
  cd "$srcdir/exploit-database"
  install -dm755 "${pkgdir}/usr/share/exploitdb"
  install -dm755 "${pkgdir}/usr/bin"
  install -dm755 "${pkgdir}/usr/share/exploitdb/platforms"
  cp -ar --no-preserve=ownership platforms/* "${pkgdir}/usr/share/exploitdb/platforms"
  install -Dm644 "README.md" "${pkgdir}/usr/share/exploitdb/README.md"
  install -Dm644 "files.csv" "${pkgdir}/usr/share/exploitdb/files.csv"
  install -Dm755 "searchsploit" "${pkgdir}/usr/bin/searchsploit"
}
